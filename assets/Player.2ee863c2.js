var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,l=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,i=(e,t)=>{for(var n in t||(t={}))o.call(t,n)&&l(e,n,t[n]);if(r)for(var n of r(t))a.call(t,n)&&l(e,n,t[n]);return e},s=(e,r)=>t(e,n(r)),c=(e,t)=>{var n={};for(var l in e)o.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&r)for(var l of r(e))t.indexOf(l)<0&&a.call(e,l)&&(n[l]=e[l]);return n};import{d,R as u,l as m,x as f,y as p,A as y,s as g}from"./vendor.afcc7ec4.js";import{a as b,b as h,u as v,S as w,D as E,d as x}from"./useJsonWebsocket.7e6abb12.js";import{u as C,P as k,a as S,B as R}from"./index.1a6f42d2.js";import"./valueConverters.45a54a63.js";function j(e){var t=e,{direction:n,fill:r,stroke:o=b,strokeWidth:a=5}=t,l=c(t,["direction","fill","stroke","strokeWidth"]);const s=d((()=>{const e=a,t=100-a;return(()=>{switch(n){case"up":return[[50,e],[e,t],[t,t]];case"down":return[[e,e],[t,e],[50,t]];case"left":return[[e,50],[t,e],[t,t]];case"right":return[[e,e],[e,t],[t,50]];default:(e=>{throw new Error(`Can't draw triangle in direction "${e}"`)})(n)}})().join(" ")}),[n,a]);return u.createElement("svg",i({viewBox:"0 0 100 100",style:{width:"100%",maxHeight:"100%",display:"block"}},l),u.createElement("polygon",{points:s,strokeWidth:a,style:{fill:r,stroke:o,strokeLinejoin:"round",transition:"fill 150ms ease-out"}}))}function O({setTurn:e,color:t,children:n}){var r,o;const[a,l]=m(0),[i,s]=m(!1),[c,d]=m(!1),f=C({"(orientation: landscape)":["left","right"],"(orientation: portrait)":["up","down"]})[0],p=(t,n)=>{const r=r=>o=>{o.preventDefault(),n(r);const i=a+(r?t:-t);e(i),l(i)};return{onPress:r(!0),onRelease:r(!1)}},y=p(-1,s),g=p(1,d);return u.createElement(k,{centered:!1},u.createElement(W,{color:t,direction:null!=(r=null==f?void 0:f[0])?r:"left",pressed:i,handler:y}),u.createElement("div",null,n),u.createElement(W,{color:t,direction:null!=(o=null==f?void 0:f[1])?o:"right",pressed:c,handler:g}))}const W=({color:e,pressed:t,handler:n,direction:r})=>u.createElement("div",{style:{padding:"0.5em",flexBasis:"33%",alignSelf:"stretch",WebkitUserSelect:"none",touchAction:"none",display:"flex"},onTouchStart:n.onPress,onTouchEnd:n.onRelease},u.createElement(j,{direction:r,stroke:e,fill:t?e:void 0}));var T=f((function(e,t){var n;return u.createElement("input",s(i({autoCapitalize:"characters",type:"text",ref:t},e),{style:S([d((()=>{var t;return((e=b)=>({width:"100%",background:"none",fontSize:"2.8em",fontWeight:900,display:"block",border:"none",borderBottom:`5px solid ${e}`,fontFamily:h,borderRadius:0,textAlign:"center",padding:"0.5em 0",textTransform:"uppercase",caretColor:e}))(null==(t=e.style)?void 0:t.color)}),[null==(n=e.style)?void 0:n.color]),e.style])}))}));var P,D=f((function(e,t){var n=e,{color:r=b}=n,o=c(n,["color"]);return u.createElement("button",s(i({ref:t},o),{style:S([d((()=>((e,t)=>({border:`5px solid ${e}`,color:e,borderRadius:"1.5em",padding:"0.5em 1.5em",fontWeight:900,fontSize:"1.5em",fontFamily:h,opacity:t?.3:1,background:"none",transition:"color 175ms ease-out, border-color 175ms ease-out"}))(r,o.disabled)),[r,o.disabled]),o.style])}),o.children)})),N=new Uint8Array(16);function $(){if(!P&&!(P="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return P(N)}var A=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function I(e){return"string"==typeof e&&A.test(e)}for(var U=[],L=0;L<256;++L)U.push((L+256).toString(16).substr(1));function V(e,t,n){var r=(e=e||{}).random||(e.rng||$)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(U[e[t+0]]+U[e[t+1]]+U[e[t+2]]+U[e[t+3]]+"-"+U[e[t+4]]+U[e[t+5]]+"-"+U[e[t+6]]+U[e[t+7]]+"-"+U[e[t+8]]+U[e[t+9]]+"-"+U[e[t+10]]+U[e[t+11]]+U[e[t+12]]+U[e[t+13]]+U[e[t+14]]+U[e[t+15]]).toLowerCase();if(!I(n))throw TypeError("Stringified UUID is invalid");return n}(r)}function z({lobbyName:e}){const[t,n]=m(),r=d((()=>{const t=`playerId/${e}`;let n=sessionStorage[t];return null==n&&(n=V(),sessionStorage[t]=n),n}),[e]),o=v(null==t?`${w}/${r}`:void 0);return p((()=>{if(null!=t||"connected"!=o.status)return;const a=new RTCPeerConnection(E),l=a.createDataChannel("Client data channel",{maxRetransmits:1,ordered:!1});l.onopen=()=>{const e=x(a,l);n(e)},a.onicecandidate=t=>{null!=t.candidate&&o.send({to:e,from:r,data:t.candidate.toJSON()})},a.oniceconnectionstatechange=()=>{clearTimeout(undefined);switch(a.iceConnectionState){case"disconnected":case"failed":n((e=>{null==e||e.destroy()}))}},o.addListener((async({data:e})=>{"answer"===e.type?await a.setRemoteDescription(e):"candidate"in e&&await a.addIceCandidate(e)})),a.createOffer().then((async t=>{await a.setLocalDescription(t),o.send({data:t,to:e,from:r})}))}),[t,e,o]),t}function B(e){const t=function(e,t=100,n=40){const[r,o]=m();return p((()=>{if(null==e)return;let r=0,a=0;const l=new Uint8Array(n),i=window.setInterval((()=>{r>a||(e.send("ping",performance.now()),r++)}),t);return e.on("ping",(e=>{l[a]=performance.now()-e,a++,a>=n&&(o(Math.round(l.reduce(((e,t)=>e+t),0)/a)),l.fill(0),a=0,r=0)})),()=>{window.clearInterval(i),o(void 0)}}),[e,t,n]),r}(e),[n,r]=m(),[o,a]=m();p((()=>{null!=e&&(e.on("playerState",(e=>r((t=>i(i({},t),e))))),e.on("gameState",(e=>a((t=>i(i({},t),e))))))}),[e]);const l=d(((e,t)=>()=>{const n=(n,r)=>o=>{r&&e((e=>e&&s(i({},e),{[r]:o}))),null==t||t.send(n,o)};return{setName:n("setName","name"),setColor:n("setColor"),setReady:n("setReady"),setTurn:n("turn")}})(r,e),[e]);return[n&&s(i(i({},n),l),{latency:t}),o]}function F({lobbyName:e="new"}){const t=z({lobbyName:e}),[n,r]=B(t),o=y((()=>{if(null==n)return u.createElement(R,null,"Connecting");switch(n.state){case"joining":return n.ready?u.createElement(R,null,"Waiting"):u.createElement(J,s(i({},n),{colors:null==r?void 0:r.colorAvailability}));case"playing":return u.createElement(O,{setTurn:n.setTurn,color:n.color,latency:n.latency});case"dead":return u.createElement(R,null,"You dead")}}),[n,r]);return u.createElement(k,null,u.createElement(H,{latency:null==n?void 0:n.latency}),o())}function J(e){var t=e,{colors:n={}}=t,r=c(t,["colors"]);const[o,a]=m(!1),l=!o&&r.name.startsWith("Player "),i=y((e=>{a(!0),r.setName(e.target.value)}),[r.setName]),s=g(null);return u.createElement("article",{style:{textAlign:"center",maxWidth:"95%",margin:"auto 0"}},u.createElement(T,{ref:s,style:{color:r.color,margin:"1em auto",maxWidth:"75%"},value:l?"":r.name,onChange:i,placeholder:l?r.name:"",maxLength:10,autoCorrect:"off",spellCheck:!1}),u.createElement("section",{style:{display:"flex",flexDirection:"row",width:"100%",flexWrap:"wrap",justifyContent:"center"}},Object.entries(n).map((([e,t])=>{const n=e===r.color;return u.createElement("figure",{key:e,onClick:()=>t&&r.setColor(e),style:{boxSizing:"border-box",width:50,height:50,margin:15,borderRadius:"50%",background:e,transform:n||!t?`scale(${n?1.2:.8})`:void 0,transition:"transform 150ms ease-out, box-shadow 150ms ease-out, opacity 75ms ease-out",opacity:n||t?1:.2,boxShadow:n?"inset 0 0 0 5px rgba(0,0,0,0.1)":"none"}},u.createElement("figcaption",{style:{visibility:"hidden"}},e))}))),u.createElement("section",{style:{marginTop:"1.5em"}},u.createElement(D,{color:r.color,disabled:!r.name,onClick:()=>r.setReady(!0)},"Ready!")))}const H=({latency:e})=>e?u.createElement("span",{style:{position:"absolute",top:0,right:0,WebkitUserSelect:"none"}},e," ms"):null;export default F;
//# sourceMappingURL=Player.2ee863c2.js.map
