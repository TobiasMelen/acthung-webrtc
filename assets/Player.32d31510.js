var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,l=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,i=(e,t)=>{for(var n in t||(t={}))o.call(t,n)&&l(e,n,t[n]);if(r)for(var n of r(t))a.call(t,n)&&l(e,n,t[n]);return e},s=(e,r)=>t(e,n(r)),c=(e,t)=>{var n={};for(var l in e)o.call(e,l)&&t.indexOf(l)<0&&(n[l]=e[l]);if(null!=e&&r)for(var l of r(e))t.indexOf(l)<0&&a.call(e,l)&&(n[l]=e[l]);return n};import{F as d,C as u,h as m,k as f,p,T as y,_ as b}from"./vendor.ed4070d0.js";import{a as h,b as g,u as w,S as v,D as E,d as C}from"./useJsonWebsocket.9d0058f6.js";import{u as x,P as R,a as O,B as k}from"./index.13f8468a.js";import{u as N,m as S}from"./valueConverters.dc38a941.js";function j(e){var t=e,{direction:n,fill:r,stroke:o=h,strokeWidth:a=5}=t,l=c(t,["direction","fill","stroke","strokeWidth"]);const s=d((()=>{const e=a,t=100-a;return(()=>{switch(n){case"up":return[[50,e],[e,t],[t,t]];case"down":return[[e,e],[t,e],[50,t]];case"left":return[[e,50],[t,e],[t,t]];case"right":return[[e,e],[e,t],[t,50]];default:(e=>{throw new Error(`Can't draw triangle in direction "${e}"`)})(n)}})().join(" ")}),[n,a]);return u.createElement("svg",i({viewBox:"0 0 100 100",style:{width:"100%",maxHeight:"100%",display:"block"}},l),u.createElement("polygon",{points:s,strokeWidth:a,style:{fill:r,stroke:o,strokeLinejoin:"round",transition:"fill 150ms ease-out"}}))}function T({setTurn:e,color:t,children:n}){var r,o;const[a,l]=m(0),[i,s]=m(!1),[c,d]=m(!1),f=x({"(orientation: landscape)":["left","right"],"(orientation: portrait)":["up","down"]})[0],p=(t,n)=>{const r=r=>o=>{o.preventDefault(),n(r);const i=a+(r?t:-t);e(i),l(i)};return{onPress:r(!0),onRelease:r(!1)}},y=p(-1,s),b=p(1,d);return u.createElement(R,{style:{justifyContent:"space-between"}},u.createElement(W,{color:t,direction:null!=(r=null==f?void 0:f[0])?r:"left",pressed:i,handler:y}),u.createElement("div",null,n),u.createElement(W,{color:t,direction:null!=(o=null==f?void 0:f[1])?o:"right",pressed:c,handler:b}))}const W=({color:e,pressed:t,handler:n,direction:r})=>u.createElement("div",{style:{padding:"0.5em",flexBasis:"33%",alignSelf:"stretch",WebkitUserSelect:"none",touchAction:"none",display:"flex"},onTouchStart:n.onPress,onTouchEnd:n.onRelease},u.createElement(j,{direction:r,stroke:e,fill:t?e:void 0}));var P=f((function(e,t){var n;return u.createElement("input",s(i({autoCapitalize:"characters",type:"text",ref:t},e),{style:O([d((()=>{var t;return((e=h)=>({width:"100%",background:"none",fontSize:"2.8em",fontWeight:900,display:"block",border:"none",borderBottom:`5px solid ${e}`,fontFamily:g,borderRadius:0,textAlign:"center",padding:"0.5em 0",textTransform:"uppercase",caretColor:e}))(null==(t=e.style)?void 0:t.color)}),[null==(n=e.style)?void 0:n.color]),e.style])}))}));var I=f((function(e,t){var n=e,{color:r=h}=n,o=c(n,["color"]);return u.createElement("button",s(i({ref:t},o),{style:O([d((()=>((e,t)=>({border:`5px solid ${e}`,color:e,borderRadius:"1.5em",padding:"0.5em 1.5em",fontWeight:900,fontSize:"1.5em",fontFamily:g,opacity:t?.3:1,background:"none",transition:"color 175ms ease-out, border-color 175ms ease-out"}))(r,o.disabled)),[r,o.disabled]),o.style])}),o.children)}));function A({lobbyName:e}){const[t,n]=m(),[r,o]=d((()=>{const t=`playerId/${e}`,n=sessionStorage[t];if(n)return[n,!0];const r=N();return sessionStorage[t]=r,[r,!1]}),[e]),[a,l]=m(o?"RECONNECTING":"CONNECTING"),i=w(null==t?`${v}/${r}`:void 0);return p((()=>{if(null!=t||"connected"!=i.status)return;const o=new RTCPeerConnection(E),a=o.createDataChannel("Client data channel",{maxRetransmits:1,ordered:!1});let s;a.onopen=()=>{const e=C(o,a);n(e)},o.onicecandidate=t=>{null!=t.candidate&&i.send({to:e,from:r,data:t.candidate.toJSON()})},o.oniceconnectionstatechange=()=>{switch(o.iceConnectionState){case"disconnected":case"failed":n((e=>{null==e||e.destroy()})),l("ERROR")}},i.addListener((async({data:e})=>{clearTimeout(s),"answer"===e.type?await o.setRemoteDescription(e):"candidate"in e&&await o.addIceCandidate(e)})),o.createOffer().then((async t=>{s=window.setTimeout((()=>{l((e=>"ERROR"!==e?"NO_LOBBY":"ERROR"))}),1e3),await o.setLocalDescription(t),i.send({data:t,to:e,from:r})}))}),[t,e,i]),[t,a]}function B(e){const t=function(e,t=100,n=40){const[r,o]=m();return p((()=>{if(null==e)return;let r=0,a=0;const l=new Uint8Array(n),i=window.setInterval((()=>{r>a||(e.send("ping",performance.now()),r++)}),t);return e.on("ping",(e=>{l[a]=performance.now()-e,a++,a>=n&&(o(Math.round(l.reduce(((e,t)=>e+t),0)/a)),a=0,r=0)})),()=>{window.clearInterval(i),o(void 0)}}),[e,t,n]),r}(e),[n,r]=m(),[o,a]=m();p((()=>{null!=e&&(e.on("playerState",(e=>r((t=>i(i({},t),e))))),e.on("gameState",(e=>a((t=>i(i({},t),e))))))}),[e]);const l=d(((e,t)=>()=>{const n=(n,r)=>o=>{r&&e((e=>e&&s(i({},e),{[r]:o}))),null==t||t.send(n,o)};return{setName:n("setName","name"),setColor:n("setColor"),setReady:n("setReady"),setTurn:n("turn")}})(r,e),[e]);return[n&&s(i(i({},n),l),{latency:t}),o]}new(window.AudioContext||window.webkitAudioContext);const L=new Audio("/acthung-webrtc/assets/wilhelm.e3230827.aac");function D({lobbyName:e="new"}){const[t,n]=A({lobbyName:e}),[r,o]=B(t);p((()=>{"dead"===(null==r?void 0:r.state)&&(L.muted=!1,L.volume=.3,L.playbackRate=2*Math.random()+.5,L.play())}),[null==r?void 0:r.state]);const a=y((()=>{if(null==r||null==t)return u.createElement(k,{key:n},S(n,{CONNECTING:"Connecting",RECONNECTING:"Reconnecting",ERROR:u.createElement(u.Fragment,null,u.createElement("span",{style:{color:"red"}},"Error connecting!"),u.createElement("br",null),"Make sure you are connected to the same Wifi as host."),NO_LOBBY:"Lobby didn't respond ðŸ˜ž"}));switch(r.state){case"joining":return r.ready?u.createElement(k,null,"Waiting. Look at big screen."):u.createElement($,s(i({},r),{colors:null==o?void 0:o.colorAvailability,onSubmit:()=>{L.muted=!0,L.play()}}));case"playing":return u.createElement(T,{setTurn:r.setTurn,color:r.color,latency:r.latency});case"dead":return u.createElement(k,null,"You crashed")}}),[r,o,n]);return u.createElement(R,null,u.createElement(z,{latency:null==r?void 0:r.latency}),a())}function $(e){var t=e,{colors:n={}}=t,r=c(t,["colors"]);const[o,a]=m(!1),l=!o&&r.name.startsWith("Player "),i=y((e=>{a(!0),r.setName(e.target.value)}),[r.setName]),s=b(null);return u.createElement("article",{style:{textAlign:"center",maxWidth:"95%",margin:"auto 0"}},u.createElement(P,{ref:s,style:{color:r.color,margin:"1em auto",maxWidth:"75%"},value:l?"":r.name,onChange:i,placeholder:l?r.name:"",maxLength:10,autoCorrect:"off",spellCheck:!1}),u.createElement("section",{style:{display:"flex",flexDirection:"row",width:"100%",flexWrap:"wrap",justifyContent:"center"}},Object.entries(n).map((([e,t])=>{const n=e===r.color;return u.createElement("figure",{key:e,onClick:()=>t&&r.setColor(e),style:{boxSizing:"border-box",width:50,height:50,margin:15,borderRadius:"50%",background:e,transform:n||!t?`scale(${n?1.2:.8})`:void 0,transition:"transform 150ms ease-out, box-shadow 150ms ease-out, opacity 75ms ease-out",opacity:n||t?1:.2,boxShadow:n?"inset 0 0 0 5px rgba(0,0,0,0.1)":"none"}},u.createElement("figcaption",{style:{visibility:"hidden"}},e))}))),u.createElement("section",{style:{marginTop:"1.5em"}},u.createElement(I,{color:r.color,disabled:!r.name,onClick:()=>{var e;null==(e=r.onSubmit)||e.call(r),r.setReady(!0)}},"Ready!")))}L.load();const z=({latency:e})=>e?u.createElement("span",{style:{position:"absolute",top:0,right:0,WebkitUserSelect:"none"}},e," ms"):null;export default D;
//# sourceMappingURL=Player.32d31510.js.map
