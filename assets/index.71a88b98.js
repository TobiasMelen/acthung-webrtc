var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,a=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,l=(e,t)=>{for(var n in t||(t={}))r.call(t,n)&&a(e,n,t[n]);if(o)for(var n of o(t))i.call(t,n)&&a(e,n,t[n]);return e},s=(e,o)=>t(e,n(o)),c=(e,t)=>{var n={};for(var a in e)r.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&o)for(var a of o(e))t.indexOf(a)<0&&i.call(e,a)&&(n[a]=e[a]);return n};import{d,l as u,y as m,R as y,s as h,A as p,x as f,v as g,a as b,q as v,z as w}from"./vendor.2c88f4c1.js";import{s as E,j as S,n as C,a as x,b as k,e as O,i as T,c as W,m as j,d as R}from"./webWorkerMessageChannel.13c0292b.js";function N(e,t){return d((()=>{const t=e.filter((e=>null!=e));return t.length<=1?t[0]:Object.assign({},...t)}),null!=t?t:e)}function P(e){const t=d((()=>Object.keys(e).map((e=>matchMedia(e)))),[e]),[n,o]=u(new Set(t.filter((e=>e.matches)).map((e=>e.media))));return m((()=>t.forEach((e=>e.addListener((e=>o((t=>((e.matches?t.add:t.delete).call(t,e.media),new Set(t))))))))),[e]),d((()=>{let t=[];return n.forEach((n=>{const o=e[n];null!=o&&t.push(o)})),t}),[n,e])}const I=e=>({width:"100vw",height:"100%",display:"flex",justifyContent:e?"center":"space-between",alignItems:"center",overflow:"hidden"}),D={"(orientation: landscape)":{flexDirection:"row",margin:"0 auto",overflow:"visible"},"(orientation: portrait)":{flexDirection:"column"}};function H(e){var t=e,{centered:n=!0}=t,o=c(t,["centered"]);const r=P(D),i=d((()=>I(n)),[n]);return y.createElement("main",s(l({},o),{style:N([i,...r,o.style],[I,r,o.style])}))}const A={textAlign:"center",margin:"0 auto"};function M({children:e,style:t,startingEm:n=20}){const o=h(null),[r,i]=u(),a=p((()=>{!async function e(t){if(null==o.current)return;o.current.style.fontSize=`${t}em`;const n=o.current.clientHeight<=document.body.scrollHeight&&o.current.clientWidth<=document.body.clientWidth;console.log(n),n?i(t):e(t-1)}(n)}),[o.current]);return m((()=>{let e;return window.addEventListener("resize",(()=>{window.clearTimeout(e),e=window.setTimeout(a,500)})),a(),()=>window.clearTimeout(e)}),[a,n]),y.createElement(H,null,y.createElement("h1",{style:s(l(l({},t),A),{visibility:null!=r?"visible":"hidden"}),ref:o},e))}const $="wss://signaling-server.tobbes.site",L="white",z='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif',J=["#3f5","#f24","#46f","#ef2","#d3f","#f9b","#fff"],F={iceServers:[{urls:["stun:stun.l.google.com:19302"]},{urls:["turn:relay.backups.cz"],credential:"webrtc",username:"webrtc"}]};function B(e){var t=e,{direction:n,fill:o,stroke:r=L,strokeWidth:i=5}=t,a=c(t,["direction","fill","stroke","strokeWidth"]);const s=d((()=>{const e=i,t=100-i;return(()=>{switch(n){case"up":return[[50,e],[e,t],[t,t]];case"down":return[[e,e],[t,e],[50,t]];case"left":return[[e,50],[t,e],[t,t]];case"right":return[[e,e],[e,t],[t,50]];default:(e=>{throw new Error(`Can't draw triangle in direction "${e}"`)})(n)}})().join(" ")}),[n,i]);return y.createElement("svg",l({viewBox:"0 0 100 100",style:{width:"100%",maxHeight:"100%",display:"block"}},a),y.createElement("polygon",{points:s,strokeWidth:i,style:{fill:o,stroke:r,strokeLinejoin:"round",transition:"fill 150ms ease-out"}}))}function q({setTurn:e,color:t,children:n}){var o,r;const[i,a]=u(0),[l,s]=u(!1),[c,d]=u(!1),m=P({"(orientation: landscape)":["left","right"],"(orientation: portrait)":["up","down"]})[0],h=(t,n)=>{const o=o=>r=>{r.preventDefault(),n(o);const l=i+(o?t:-t);e(l),a(l)};return{onPress:o(!0),onRelease:o(!1)}},p=h(-1,s),f=h(1,d);return y.createElement(H,{centered:!1},y.createElement(G,{color:t,direction:null!=(o=null==m?void 0:m[0])?o:"left",pressed:l,handler:p}),y.createElement("div",null,n),y.createElement(G,{color:t,direction:null!=(r=null==m?void 0:m[1])?r:"right",pressed:c,handler:f}))}const G=({color:e,pressed:t,handler:n,direction:o})=>y.createElement("div",{style:{padding:"0.5em",flexBasis:"33%",alignSelf:"stretch",WebkitUserSelect:"none",touchAction:"none",display:"flex"},onTouchStart:n.onPress,onTouchEnd:n.onRelease},y.createElement(B,{direction:o,stroke:e,fill:t?e:void 0}));var U=f((function(e,t){var n;return y.createElement("input",s(l({autoCapitalize:"characters",type:"text",ref:t},e),{style:N([d((()=>{var t;return((e=L)=>({width:"100%",background:"none",fontSize:"2.8em",fontWeight:900,display:"block",border:"none",borderBottom:`5px solid ${e}`,fontFamily:z,borderRadius:0,textAlign:"center",padding:"0.5em 0",textTransform:"uppercase",caretColor:e}))(null==(t=e.style)?void 0:t.color)}),[null==(n=e.style)?void 0:n.color]),e.style])}))}));var V=f((function(e,t){var n=e,{color:o=L}=n,r=c(n,["color"]);return y.createElement("button",s(l({ref:t},r),{style:N([d((()=>((e,t)=>({border:`5px solid ${e}`,color:e,borderRadius:"1.5em",padding:"0.5em 1.5em",fontWeight:900,fontSize:"1.5em",fontFamily:z,opacity:t?.3:1,background:"none",transition:"color 175ms ease-out, border-color 175ms ease-out"}))(o,r.disabled)),[o,r.disabled]),r.style])}),r.children)}));const Y={playerState:S,gameState:S,ping:C,err:S},_={setColor:x,setReady:k,setName:x,turn:C,ping:C};function Q(e,t){return X(e,t)(Y,_,"ping")}function X(e,t){return E({send:e=>"open"===t.readyState&&t.send(e),bindReceive:n=>(t.addEventListener("message",(e=>n(e.data))),()=>{t.close(),e.close()})})}function K({lobbyName:e}){const[t,n]=u(),o=d((()=>{const t=`playerId/${e}`;let n=sessionStorage[t];return null==n&&(n=g(),sessionStorage[t]=n),n}),[e]);return m((()=>{if(null!=t)return;const r=new WebSocket(`${$}/${o}`);r.addEventListener("open",(async()=>{const t=new RTCPeerConnection(F),i=t.createDataChannel("Client data channel",{maxRetransmits:1,ordered:!1});i.onopen=()=>{const e=X(t,i)(_,Y);n(e)},t.onicecandidate=t=>{null!=t.candidate&&r.send(JSON.stringify({to:e,from:o,data:t.candidate.toJSON()}))},t.oniceconnectionstatechange=()=>{clearTimeout(undefined);switch(t.iceConnectionState){case"disconnected":case"failed":n((e=>{null==e||e.destroy()}))}},r.addEventListener("message",(async({data:e})=>{const{data:n}=JSON.parse(e);"answer"===n.type?await t.setRemoteDescription(n):"candidate"in n&&await t.addIceCandidate(n)}));const a=await t.createOffer();await t.setLocalDescription(await a),r.send(JSON.stringify({data:a,to:e,from:o}))}))}),[t,e]),t}function Z(e){const t=function(e,t=100,n=40){const[o,r]=u();return m((()=>{if(null==e)return;let o=0,i=0;const a=new Uint8Array(n),l=window.setInterval((()=>{o>i||(e.send("ping",performance.now()),o++)}),t);return e.on("ping",(e=>{a[i]=performance.now()-e,i++,i>=n&&(r(Math.round(a.reduce(((e,t)=>e+t),0)/i)),a.fill(0),i=0,o=0)})),()=>{window.clearInterval(l),r(void 0)}}),[e,t,n]),o}(e),[n,o]=u(),[r,i]=u();m((()=>{null!=e&&(e.on("playerState",(e=>o((t=>l(l({},t),e))))),e.on("gameState",(e=>i((t=>l(l({},t),e))))))}),[e]);const a=d(((e,t)=>()=>{const n=(n,o)=>r=>{o&&e((e=>e&&s(l({},e),{[o]:r}))),null==t||t.send(n,r)};return{setName:n("setName","name"),setColor:n("setColor"),setReady:n("setReady"),setTurn:n("turn")}})(o,e),[e]);return[n&&s(l(l({},n),a),{latency:t}),r]}function ee({lobbyName:e="new"}){const t=K({lobbyName:e}),[n,o]=Z(t),r=p((()=>{if(null==n)return y.createElement(M,null,"Connecting");switch(n.state){case"joining":return n.ready?y.createElement(M,null,"Waiting"):y.createElement(te,s(l({},n),{colors:null==o?void 0:o.colorAvailability}));case"playing":return y.createElement(q,{setTurn:n.setTurn,color:n.color,latency:n.latency});case"dead":return y.createElement(M,null,"You dead")}}),[n,o]);return y.createElement(H,null,y.createElement(ne,{latency:null==n?void 0:n.latency}),r())}function te(e){var t=e,{colors:n={}}=t,o=c(t,["colors"]);const[r,i]=u(!1),a=!r&&o.name.startsWith("Player "),l=p((e=>{i(!0),o.setName(e.target.value)}),[o.setName]),s=h(null);return y.createElement("article",{style:{textAlign:"center",maxWidth:"95%",margin:"auto 0"}},y.createElement(U,{ref:s,style:{color:o.color,margin:"1em auto",maxWidth:"75%"},value:a?"":o.name,onChange:l,placeholder:a?o.name:"",maxLength:10,autoCorrect:"off",spellCheck:!1}),y.createElement("section",{style:{display:"flex",flexDirection:"row",width:"100%",flexWrap:"wrap",justifyContent:"center"}},Object.entries(n).map((([e,t])=>{const n=e===o.color;return y.createElement("figure",{key:e,onClick:()=>t&&o.setColor(e),style:{boxSizing:"border-box",width:50,height:50,margin:15,borderRadius:"50%",background:e,transform:n||!t?`scale(${n?1.2:.8})`:void 0,transition:"transform 150ms ease-out, box-shadow 150ms ease-out, opacity 75ms ease-out",opacity:n||t?1:.2,boxShadow:n?"inset 0 0 0 5px rgba(0,0,0,0.1)":"none"}},y.createElement("figcaption",{style:{visibility:"hidden"}},e))}))),y.createElement("section",{style:{marginTop:"1.5em"}},y.createElement(V,{color:o.color,disabled:!o.name,onClick:()=>o.setReady(!0)},"Ready!")))}const ne=({latency:e})=>e?y.createElement("span",{style:{position:"absolute",top:0,right:0,WebkitUserSelect:"none"}},e," ms"):null;function oe(e,t){const n=h();m((()=>{const o=n.current;return n.current=t,e(o)}),t)}const re=(e=[])=>J.reduce(((t,n)=>(t[n]=-1===e.indexOf(n),t)),{});function ie(e){const[t,n]=u({}),[o,r]=u({colorAvailability:re()});oe((t=>{const[r]=null!=t?t:[{}];let i;n((t=>{let a=1;return Object.keys(e).reduce(((d,u,m)=>{const y=t[u],h=(p=u,e=>n((t=>{var n,o=t,{[p]:r}=o,i=c(o,[(n=p,"symbol"==typeof n?n:n+"")]);return s(l({},i),{[p]:e(r)})})));var p;let f=null!=y?y:(()=>{var t;i=null!=i?i:l({},o.colorAvailability);const n=null==(t=Object.entries(i).find((([e,t])=>t)))?void 0:t[0];if(null!=n)return i[n]=!1,{id:u,name:`Player ${m+1}`,color:n,ready:!1,score:0,state:"joining",latency:0,setState:e=>h((t=>s(l({},t),{state:e}))),setScore:e=>h((t=>s(l({},t),{score:e}))),onTurnInput:t=>{var n;return null==(n=e[u])?void 0:n.on("turn",t)}}})();if(null==f)return e[u].send("err",{reason:"lobbyFull",queuespot:a}),a++,d;const g=e[u];return null!=y&&g===r[u]||(g.on("setColor",(e=>{h((t=>s(l({},t),{color:e})))})),g.on("setName",(e=>{h((t=>s(l({},t),{name:e})))})),g.on("setReady",(e=>{h((t=>s(l({},t),{ready:e})))})),f=s(l({},f),{onTurnInput:t=>{var n;return null==(n=e[u])?void 0:n.on("turn",t)}})),d[u]=f,d}),{})}))}),[e]);const i=Object.values(t).map((e=>e.color));m((()=>{r((e=>s(l({},e),{colorAvailability:re(i)})))}),[i.join(":")]),oe((n=>{const[o,r]=null!=n?n:[];Object.keys(t).forEach((n=>{var i,a;const l=t[n],s=null==r?void 0:r[n];e[n]!=(null==o?void 0:o[n])||null==s?null==(i=e[n])||i.send("playerState",l):l!==s&&(null==(a=e[n])||a.send("playerState",O(s,l,"function")))}))}),[e,t]),oe((t=>{const[n,r]=null!=t?t:[],i=r!==o&&O(r,o);Object.keys(e).forEach((t=>{const r=e[t];r!=(null==n?void 0:n[t])?null==r||r.send("gameState",o):i&&(null==r||r.send("gameState",i))}))}),[e,o]);return d((()=>Object.values(t)),[t])}function ae(){return new Worker("/acthung-webrtc/assets/collisionCanvas.7fd268f4.js",{type:"module"})}function le(e,{snakeSpeed:t=3.3,lineWidth:n=8,turnRadius:o=.05,startPositionSpread:r=.5,startingHoleChancePercantage:i=-5,holeDuration:a=10,maxVerticalResolution:c=1080,checkCollisions:d=!0,useTrackingCollisionCanvas:u=!1}={}){var m;const y=null!=(m=e.getContext("2d",{desynchronized:!0,willReadFrequently:!0}))?m:T("Could not get Snake canvas 2d context"),h=e.height>c?e.height/c:1;y.scale(h,h);const p=[];function f(t,o,r,s=!1){if(t.hasCollided)return;0==t.currentHoleSection&&(t.holeChance>0&&100*Math.random()<t.holeChance?(t.currentHoleSection=a,t.holeChance=i):t.holeChance=t.holeChance+.1);if(s&&(t.position.x<0||t.position.x>e.width||t.position.y<0||t.position.y>e.height||0!==y.getImageData(t.position.x+(o+n/2)*Math.cos(t.direction),t.position.y+(o+n/2)*Math.sin(t.direction),1,1).data[3])&&(t.hasCollided=!0,t.onCollision()),null!=t.erasePos){y.beginPath(),y.lineCap="square",y.lineWidth=n+3;const e=y.globalCompositeOperation;y.globalCompositeOperation="destination-out",y.moveTo(t.erasePos.x,t.erasePos.y),y.lineTo(t.position.x,t.position.y),y.stroke(),y.closePath(),t.erasePos=null,y.globalCompositeOperation=e}t.currentHoleSection>0&&(t.erasePos=l({},t.position),t.currentHoleSection--),y.beginPath(),y.lineCap="square",y.lineWidth=n,y.strokeStyle=t.color,y.moveTo(t.position.x,t.position.y),t.direction+=t.turn*r,t.position.x+=o*Math.cos(t.direction),t.position.y+=o*Math.sin(t.direction),y.lineTo(t.position.x,t.position.y),y.stroke(),y.closePath()}const g=[];function b(t,o,r){t.send("canvasInfo",{width:e.width,height:e.height,scaleFactor:h,lineWidth:n}),g.push({interval:o,channel:t,latestReport:0}),r&&t.on("reportCollision",(e=>{const t=p.find((t=>t.id===e));t&&(t.hasCollided=!0,t.onCollision())}))}const v=u&&(()=>{const e=new ae;e.postMessage("SELF_HOST_CANVAS");return b(W(e)(j,R),50,!0),e})();let w=!0;function E(){w=!0}return{run:function(){let e=performance.now(),n=!1;w&&(w=!1,requestAnimationFrame((function r(i){let a=(i-e)/16.666666666666668;a=a<4?a:4;const l=t*a,s=o*a;e=i;for(let e=0;e<p.length;e++)f(p[e],l,s,d&&!!(e%2)===n);n=!n;for(const e of g){let t=null;i-e.latestReport>=e.interval&&(null!=t||(t=p.filter((e=>!e.hasCollided)).map((e=>({id:e.id,fill:e.currentHoleSection?void 0:e.color,x:e.position.x,y:e.position.y})))),e.channel.send("positionData",t))}!w&&requestAnimationFrame(r)})))},stop:E,inputSnakeData:e=>{let t=p.find((t=>t.id===e.id));return null==t&&(t=(e=>s(l({},e),{hasCollided:!1,turn:0,direction:Math.round(360*Math.random()),holeChance:i,position:{x:(Math.random()+r)*(y.canvas.width*r),y:(Math.random()+r)*(y.canvas.height*r)},currentHoleSection:0,erasePos:null}))(e),p.push(t)),e=>{t.turn=e}},addTrackingChannel:b,destroy(){v&&v.terminate(),E()}}}const se={flexGrow:1,height:"100%",width:"100%"};function ce({run:e,input:t,children:n}){const o=h(null),[r,i]=u();return m((()=>{if(null==o.current||r)return()=>i((e=>{null==e||e.destroy()}));(async function(e,t={}){var n=t,{maxVerticalResolution:o=1080}=n,r=c(n,["maxVerticalResolution"]);e.style.height="100%",e.style.width="100%",e.clientHeight>o?(e.height=o,e.width=o/e.clientHeight*e.clientWidth):(e.height=e.clientHeight,e.width=e.clientWidth);const i=await(window,le)(e,r);return s(l({},i),{destroy(){i.destroy()}})})(o.current).then((e=>{i(e)}))}),[o.current]),m((()=>{if(null!=r)for(const e of t){const t=r.inputSnakeData(e);e.onTurnInput(t)}}),[r,t]),m((()=>{null!=r&&(e?r.run():r.stop())}),[r,e]),y.createElement("canvas",{ref:o,style:se})}function de({children:e,style:t}){return y.createElement(b.QRCode,{value:e,bgColor:"white",fgColor:"black",style:l({backgroundColor:"white",display:"block",position:"relative"},t),preserveAspectRatio:"xMidYMax slice"})}const ue={display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"start"};function me({url:e,players:t}){return y.createElement(H,null,y.createElement("div",null),y.createElement("div",{style:{width:"50%",maxHeight:"75%"}},y.createElement(de,{colorScheme:"onWhiteBg",padding:2,style:{maxWidth:600,maxHeight:600,margin:"0 auto 2em auto"}},e),y.createElement("a",{href:e,style:{textAlign:"center",display:"block",fontSize:"0.8em",marginTop:"0.8em",alignSelf:"center"}},e)),y.createElement("div",{style:s(l({},ue),{width:0,flexGrow:t.length?.5:0,transition:"flex-grow 500ms ease-in"})},t.map((e=>y.createElement(ye,l({key:e.id},e))))))}const ye=e=>{const[t,n]=u(!1);return m((()=>{window.setTimeout((()=>n(!0)),100)}),[]),y.createElement("div",{style:{opacity:t?1:0,margin:"1.2em 0",transition:"transform 150ms ease-in, opacity 150ms ease-in",transform:e.ready?"scale(1.1) translateX(5%)":void 0,animation:"fadeIn 250ms ease-in, fromRight 500ms ease-in",minWidth:"7em"},key:e.id},y.createElement("h2",{style:{color:e.color,fontSize:"3em",transition:"color 150ms",whiteSpace:"nowrap"}},e.name," ",e.ready?y.createElement("small",null,"👍"):"  "))};const he={snakeSpeed:3.3,lineWidth:8,turnRadius:.05,startPositionSpread:.5,startingHoleChancePercantage:-5,holeDuration:10,maxVerticalResolution:1080},pe=v([he,()=>{}]);function fe({children:e}){const t=function(e,t){const n=d((()=>(null==localStorage?void 0:localStorage[e])?JSON.parse(localStorage[e]):t),[]),[o,r]=u(n);return m((()=>{localStorage&&(localStorage[e]=JSON.stringify(o))}),[o]),[o,r]}("gameSettings",he);return y.createElement(pe.Provider,{value:t},e)}function ge({players:e,url:t}){return y.createElement("div",{style:{position:"absolute",zIndex:-1,right:0,display:"flex",flexDirection:"column",justifyContent:"center",height:"100%"}},y.createElement("div",{style:{flexGrow:1,display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"flex-end"}},e.map((e=>y.createElement("div",{key:e.id,style:{color:e.color,textAlign:"right",margin:"0 1.5em",paddingBottom:"2em"}},y.createElement("div",{style:{fontSize:"5.2em"}},e.score),y.createElement("div",{style:{fontSize:"1.2em",whiteSpace:"nowrap"}},e.name))))),J.length>e.length&&y.createElement(de,{colorScheme:"onWhiteBg",padding:2,style:{width:150,height:150,margin:"2em"}},t))}const be=(e,t)=>({type:"intermission",remainingTime:5,roundWinner:e,gameWinner:t});function ve({lobbyName:e}){const t=ie(function(e){const[t,n]=u({}),o=d((()=>new WebSocket(`${$}/${e}`)),[$,e]),r=p((e=>{n((t=>Object.keys(t).reduce(((n,o)=>{var r;if((null==(r=t[o])?void 0:r[0])!==e)n[o]=t[o];else try{t[o][1].destroy()}catch(i){console.error("Error cleaning up stale connection",i)}return n}),{})))}),[n]),i=p(((e,t)=>({channel:o})=>{o.onclose=()=>r(e),n((n=>s(l({},n),{[t]:[e,Q(e,o)]})))}),[n]);return m((()=>{o.addEventListener("message",(async({data:e})=>{const{from:t,data:n}=JSON.parse(e);if("offer"!==n.type||null==t)return;const a=new RTCPeerConnection(F);a.ondatachannel=i(a,t),a.onicecandidate=e=>null!=e.candidate&&o.send(JSON.stringify({to:t,data:e.candidate.toJSON()})),a.oniceconnectionstatechange=()=>{"failed"===a.iceConnectionState||"disconnected"===a.iceConnectionState&&r(a)},o.addEventListener("message",(({data:e})=>{const{from:n,data:o}=JSON.parse(e);return n===t&&"candidate"in o&&a.addIceCandidate(o)})),await a.setRemoteDescription(new RTCSessionDescription(n));const l=await a.createAnswer();await a.setLocalDescription(l),o.send(JSON.stringify({data:l,to:t}))}))}),[o,i]),d((()=>Object.entries(t).reduce(((e,[t,n])=>(e[t]=n[1],e)),{})),[t])}(e));return y.createElement(fe,null,y.createElement(we,{lobbyName:e,players:t}))}function we({lobbyName:e,players:t}){const[n,o]=u({type:"lobby"}),r=d((()=>5*(t.length||1)),[t.length]);m((()=>{if("intermission"===n.type)if(n.remainingTime){const e=setTimeout((()=>(o(s(l({},n),{remainingTime:n.remainingTime-1})),()=>clearTimeout(e))),1e3)}else o({type:"playing",running:!0,joinedPlayerIds:t.filter((e=>e.ready)).map((e=>(e.setState("playing"),e.id)))})}),[n]),m((()=>{"lobby"===n.type&&t.length&&t.every((e=>e.ready))&&o(be()),"lobby"===n.type||t.some((e=>e.ready))||o({type:"lobby"})}),[t,n.type]);const i=d((()=>{if("playing"!==n.type)return null;const e=t.filter((e=>n.joinedPlayerIds.includes(e.id)));return{joined:e,alive:e.filter((e=>"playing"===e.state))}}),[n.type,t]);m((()=>{if(!i)return;const e=i.alive.length,t=1===e&&1===i.joined.length;if(e<=1&&!t){o((e=>s(l({},e),{running:!1})));const e=i.joined.reduce(((e,t)=>{var n;return t.score>(null!=(n=null==e?void 0:e.score)?n:0)?t:e}),null);window.setTimeout((()=>{o((t=>{var n,o;return"playing"===t.type?be(null!=(n=i.alive[0])?n:{color:"inherit",name:"Nobody"},(null!=(o=null==e?void 0:e.score)?o:0)>r?e:void 0):t}))}),1e3)}}),[i]);const a=d((()=>"playing"===n.type?t.filter((e=>n.joinedPlayerIds.includes(e.id))).map((e=>({id:e.id,color:e.color,onCollision:()=>(e=>{null!=i&&(e.setState("dead"),i.alive.filter((t=>t.id!==e.id)).forEach((e=>e.setScore(e.score+1))))})(e),onTurnInput:e.onTurnInput}))):[]),[n.type,t]),c=`${window.location.protocol}//${window.location.host}${window.location.pathname}#${e}`;switch(n.type){case"lobby":return y.createElement(me,{players:t,url:c});case"playing":return y.createElement(H,null,y.createElement(ce,{input:a,run:n.running}),y.createElement(ge,{players:t,url:c}));case"intermission":{const e=null!=n.gameWinner?y.createElement(M,null,y.createElement("span",{style:{color:n.gameWinner.color}},n.gameWinner.name)," ","wins the game!"):n.remainingTime<=3?y.createElement(M,{key:"countdown"},n.roundWinner?"Next round":"Game starts"," in"," ",y.createElement("span",{style:{width:"1em",display:"inline-block"}},n.remainingTime)):n.roundWinner?y.createElement(M,null,y.createElement("span",{style:{color:n.roundWinner.color}},n.roundWinner.name)," ","survives"):y.createElement(M,null,"Get ready");return y.createElement(H,{key:n.remainingTime>3?"message":"countdown"},e)}}}const Ee=()=>location.hash.startsWith("#")?location.hash.substring(1):location.hash;function Se(){const[e,t]=u(Ee());if(m((()=>{const e=()=>t(Ee());return addEventListener("hashchange",e),()=>removeEventListener("hashchange",e)}),[t]),!window.RTCPeerConnection)return y.createElement(M,null,y.createElement("span",{style:{color:"red"}},"Sorry!"),y.createElement("br",null),"Your browser must support "," ",y.createElement("a",{href:"https://caniuse.com/?search=webrtc"},"WebRTC"));if(e.startsWith("lobby/")){const t=e.substring("lobby/".length);return y.createElement(ve,{lobbyName:t})}return location.hash.length>0?y.createElement(ee,{lobbyName:e}):y.createElement(M,null,"New"," ",y.createElement("a",{href:`#lobby/${Math.random().toString(36).substring(8)}`},"Lobby"))}w(y.createElement(Se,null),document.getElementById("app-root"));
