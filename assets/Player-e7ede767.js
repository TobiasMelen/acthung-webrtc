import{F as h,C as l,h as f,u as v,P as p,k as I,b as P,p as C,T as L,B as E,_ as A}from"./index-8f09d9d8.js";import{b as w,d as N,f as F,u as B,S as M,D as _,g as $,m as G}from"./utility-9b4a527b.js";function W({direction:e,fill:t,stroke:s=w,strokeWidth:n=5,...i}){const u=h(()=>{const o=n,r=50,a=100-n;return(()=>{switch(e){case"up":return[[r,o],[o,a],[a,a]];case"down":return[[o,o],[a,o],[r,a]];case"left":return[[o,r],[a,o],[a,a]];case"right":return[[o,o],[o,a],[a,r]];default:(m=>{throw new Error(`Can't draw triangle in direction "${m}"`)})(e)}})().join(" ")},[e,n]);return l.createElement("svg",{viewBox:"0 0 100 100",style:{width:"100%",maxHeight:"100%",display:"block"},...i},l.createElement("polygon",{points:u,strokeWidth:n,style:{fill:t,stroke:s,strokeLinejoin:"round",transition:"fill 150ms ease-out"}}))}function D({setTurn:e,color:t,children:s}){const[n,i]=f(0),[u,o]=f(!1),[r,a]=f(!1),c=v({"(orientation: landscape)":["left","right"],"(orientation: portrait)":["up","down"]})[0],m=(b,O)=>{const R=S=>k=>{k.preventDefault(),O(S);const x=n+(S?b:-b);e(x),i(x)};return{onPress:R(!0),onRelease:R(!1)}},d=m(-1,o),y=m(1,a);return l.createElement(p,{style:{justifyContent:"space-between"}},l.createElement(T,{color:t,direction:(c==null?void 0:c[0])??"left",pressed:u,handler:d}),l.createElement("div",null,s),l.createElement(T,{color:t,direction:(c==null?void 0:c[1])??"right",pressed:r,handler:y}))}const T=({color:e,pressed:t,handler:s,direction:n})=>l.createElement("div",{style:{padding:"0.5em",flexBasis:"33%",alignSelf:"stretch",WebkitUserSelect:"none",touchAction:"none",display:"flex"},onTouchStart:s.onPress,onTouchEnd:s.onRelease},l.createElement(W,{direction:n,stroke:e,fill:t?e:void 0})),U=(e=w)=>({width:"100%",background:"none",fontSize:"2.8em",fontWeight:900,display:"block",border:"none",borderBottom:`5px solid ${e}`,fontFamily:N,borderRadius:0,textAlign:"center",padding:"0.5em 0",textTransform:"uppercase",caretColor:e});function j(e,t){var s;return l.createElement("input",{autoCapitalize:"characters",type:"text",ref:t,...e,style:P([h(()=>{var n;return U((n=e.style)==null?void 0:n.color)},[(s=e.style)==null?void 0:s.color]),e.style])})}const z=I(j),Y=(e,t)=>({border:`5px solid ${e}`,color:e,borderRadius:"1.5em",padding:"0.5em 1.5em",fontWeight:900,fontSize:"1.5em",fontFamily:N,opacity:t?.3:1,background:"none",transition:"color 175ms ease-out, border-color 175ms ease-out"});function H({color:e=w,...t},s){return l.createElement("button",{ref:s,...t,style:P([h(()=>Y(e,t.disabled),[e,t.disabled]),t.style])},t.children)}const J=I(H);function V({lobbyName:e}){const[t,s]=f(),[n,i]=h(()=>{const a=`playerId/${e}`,c=sessionStorage[a];if(c)return[c,!0];const m=F();return sessionStorage[a]=m,[m,!1]},[e]),[u,o]=f(i?"RECONNECTING":"CONNECTING"),r=B(t==null?`${M}/${n}`:void 0);return C(()=>{if(t!=null||r.status!="connected")return;const a=new RTCPeerConnection(_),c=a.createDataChannel("Client data channel",{maxRetransmits:1,ordered:!1});c.onopen=()=>{const d=$(a,c);s(d)},a.onicecandidate=d=>{d.candidate!=null&&r.send({to:e,from:n,data:d.candidate.toJSON()})},a.oniceconnectionstatechange=()=>{const d=()=>{s(y=>{y==null||y.destroy()}),o("ERROR")};switch(a.iceConnectionState){case"disconnected":case"failed":{d();break}}};let m;r.addListener(async({data:d})=>{clearTimeout(m),d.type==="answer"?await a.setRemoteDescription(d):"candidate"in d&&await a.addIceCandidate(d)}),a.createOffer().then(async d=>{m=window.setTimeout(()=>{o(y=>y!=="ERROR"?"NO_LOBBY":"ERROR")},1e3),await a.setLocalDescription(d),r.send({data:d,to:e,from:n})})},[t,e,r]),[t,u]}function q(e,t=100,s=40){const[n,i]=f();return C(()=>{if(e==null)return;let u=0,o=0;const r=new Uint8Array(s),a=window.setInterval(()=>{u>o||(e.send("ping",performance.now()),u++)},t);return e.on("ping",c=>{r[o]=performance.now()-c,o++,o>=s&&(i(Math.round(r.reduce((m,d)=>m+d,0)/o)),o=0,u=0)}),()=>{window.clearInterval(a),i(void 0)}},[e,t,s]),n}const Q=(e,t)=>()=>{const s=(n,i)=>u=>{i&&e(o=>o&&{...o,[i]:u}),t==null||t.send(n,u)};return{setName:s("setName","name"),setColor:s("setColor"),setReady:s("setReady"),setTurn:s("turn")}};function X(e){const t=q(e),[s,n]=f(),[i,u]=f();C(()=>{e!=null&&(e.on("playerState",r=>n(a=>({...a,...r}))),e.on("gameState",r=>u(a=>({...a,...r}))))},[e]);const o=h(Q(n,e),[e]);return[s&&{...s,...o,latency:t},i]}const Z="/acthung-webrtc/assets/wilhelm-e3230827.aac",K=window.AudioContext||window.webkitAudioContext;new K;const g=new Audio(Z);g.load();function se({lobbyName:e="new"}){const[t,s]=V({lobbyName:e}),[n,i]=X(t);C(()=>{(n==null?void 0:n.state)==="dead"&&(g.muted=!1,g.volume=.3,g.playbackRate=2*Math.random()+.5,g.play())},[n==null?void 0:n.state]);const u=L(()=>{if(n==null||t==null)return l.createElement(E,{key:s},G(s,{CONNECTING:"Connecting",RECONNECTING:"Reconnecting",ERROR:l.createElement(l.Fragment,null,l.createElement("span",{style:{color:"red"}},"Error connecting!"),l.createElement("br",null),"Make sure you are connected to the same Wifi as host."),NO_LOBBY:"Lobby didn't respond ðŸ˜ž"}));switch(n.state){case"joining":return n.ready?l.createElement(E,null,"Waiting. Look at big screen."):l.createElement(ee,{...n,colors:i==null?void 0:i.colorAvailability,onSubmit:()=>{g.muted=!0,g.play()}});case"playing":return l.createElement(D,{setTurn:n.setTurn,color:n.color,latency:n.latency});case"dead":return l.createElement(E,null,"You crashed")}},[n,i,s]);return l.createElement(p,null,l.createElement(te,{latency:n==null?void 0:n.latency}),u())}function ee({colors:e={},...t}){const[s,n]=f(!1),i=!s&&t.name.startsWith("Player "),u=L(r=>{n(!0),t.setName(r.target.value)},[t.setName]),o=A(null);return l.createElement("article",{style:{textAlign:"center",maxWidth:"95%",margin:"auto 0"}},l.createElement(z,{ref:o,style:{color:t.color,margin:"1em auto",maxWidth:"75%"},value:i?"":t.name,onChange:u,placeholder:i?t.name:"",maxLength:10,autoCorrect:"off",spellCheck:!1}),l.createElement("section",{style:{display:"flex",flexDirection:"row",width:"100%",flexWrap:"wrap",justifyContent:"center"}},Object.entries(e).map(([r,a])=>{const c=r===t.color;return l.createElement("figure",{key:r,onClick:()=>a&&t.setColor(r),style:{boxSizing:"border-box",width:50,height:50,margin:15,borderRadius:"50%",background:r,transform:c||!a?`scale(${c?1.2:.8})`:void 0,transition:"transform 150ms ease-out, box-shadow 150ms ease-out, opacity 75ms ease-out",opacity:c||a?1:.2,boxShadow:c?"inset 0 0 0 5px rgba(0,0,0,0.1)":"none"}},l.createElement("figcaption",{style:{visibility:"hidden"}},r))})),l.createElement("section",{style:{marginTop:"1.5em"}},l.createElement(J,{color:t.color,disabled:!t.name,onClick:()=>{var r;(r=t.onSubmit)==null||r.call(t),t.setReady(!0)}},"Ready!")))}const te=({latency:e})=>e?l.createElement("span",{style:{position:"absolute",top:0,right:0,WebkitUserSelect:"none"}},e," ms"):null;export{se as default};
//# sourceMappingURL=Player-e7ede767.js.map
