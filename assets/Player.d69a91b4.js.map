{"version":3,"file":"Player.d69a91b4.js","sources":["../../src/components/Triangle.tsx","../../src/components/PlayerControls.tsx","../../src/components/Input.tsx","../../src/components/Button.tsx","../../src/hooks/useConnectionForPlayer.ts","../../src/hooks/useStateForPlayer.tsx","../../src/hooks/usePingLatency.ts","../../src/components/Player.tsx"],"sourcesContent":["import { ComponentProps, useMemo } from \"react\";\nimport React from \"react\";\nimport { DEFAULT_COLOR } from \"../constants\";\n\nexport type TriangleDirection = \"up\" | \"down\" | \"left\" | \"right\";\n\ntype Props = {\n  strokeWidth?: number;\n  direction: TriangleDirection;\n} & ComponentProps<\"svg\">;\n\ntype Point = [number, number];\n\nexport default function Triangle({\n  direction,\n  fill,\n  stroke = DEFAULT_COLOR,\n  strokeWidth = 5,\n  ...props\n}: Props) {\n  const points = useMemo(() => {\n    const min = strokeWidth;\n    const half = 50;\n    const max = 100 - strokeWidth;\n    const points = ((): [Point, Point, Point] => {\n      switch (direction) {\n        case \"up\":\n          return [\n            [half, min],\n            [min, max],\n            [max, max]\n          ];\n        case \"down\":\n          return [\n            [min, min],\n            [max, min],\n            [half, max]\n          ];\n        case \"left\":\n          return [\n            [min, half],\n            [max, min],\n            [max, max]\n          ];\n        case \"right\":\n          return [\n            [min, min],\n            [min, max],\n            [max, half]\n          ];\n        default:\n          ((noValue: never) => {\n            throw new Error(`Can't draw triangle in direction \"${noValue}\"`);\n          })(direction);\n      }\n    })();\n    return points.join(\" \");\n  }, [direction, strokeWidth]);\n  return (\n    <svg viewBox=\"0 0 100 100\" style={{width: \"100%\", maxHeight: \"100%\", display: \"block\"}} {...props}>\n      <polygon\n        points={points}\n        strokeWidth={strokeWidth}\n        style={{\n          fill,\n          stroke,\n          strokeLinejoin: \"round\",\n          transition: \"fill 150ms ease-out\"\n        }}\n      />\n    </svg>\n  );\n}\n","import {\n  CSSProperties,\n  useState,\n  SyntheticEvent,\n  PropsWithChildren\n} from \"react\";\nimport React from \"react\";\nimport Triangle, { TriangleDirection } from \"./Triangle\";\nimport useMediaMatch from \"../hooks/useMediaMatch\";\nimport PlayerLayout from \"./Layout\";\n\ntype Props = PropsWithChildren<{\n  latency?: number;\n  color: CSSProperties[\"color\"];\n  setTurn(turn: number): void;\n}>;\n\nexport default function PlayerControls({ setTurn, color, children }: Props) {\n  const [currentTurn, setCurrentTurn] = useState(0);\n  const [minusPressed, setMinusPressed] = useState(false);\n  const [plusPressed, setPlusPressed] = useState(false);\n  const arrowDirections = useMediaMatch<[TriangleDirection, TriangleDirection]>(\n    {\n      \"(orientation: landscape)\": [\"left\", \"right\"],\n      \"(orientation: portrait)\": [\"up\", \"down\"]\n    }\n  )[0];\n\n  // I \"layman benchmarked\" using hooks here.\n  // creating a memo with the same code and currentTurn as dep is moot since it's regenerated everytime this renders.\n  // the other option would be to wait until state commital before passing current turn to setTurn (online)\n  // state commits can happen with some delay however, and until this shows a performance issue i see no need.\n  const useInputHandlers = (\n    value: number,\n    setPress: (press: boolean) => void\n  ) => {\n    const handle = (press: boolean) => (ev: SyntheticEvent) => {\n      ev.preventDefault();\n      setPress(press);\n      const newTurnValue = currentTurn + (press ? value : -value);\n      setTurn(newTurnValue);\n      setCurrentTurn(newTurnValue);\n    };\n    return {\n      onPress: handle(true),\n      onRelease: handle(false)\n    };\n  };\n  const turnMinus = useInputHandlers(-1, setMinusPressed);\n  const turnPlus = useInputHandlers(1, setPlusPressed);\n\n  return (\n    <PlayerLayout centered={false}>\n      <TurnButton\n        color={color}\n        direction={arrowDirections?.[0] ?? \"left\"}\n        pressed={minusPressed}\n        handler={turnMinus}\n      />\n      <div>{children}</div>\n      <TurnButton\n        color={color}\n        direction={arrowDirections?.[1] ?? \"right\"}\n        pressed={plusPressed}\n        handler={turnPlus}\n      />\n    </PlayerLayout>\n  );\n}\n\nconst TurnButton = ({\n  color,\n  pressed,\n  handler,\n  direction\n}: {\n  color?: string;\n  pressed: boolean;\n  direction: TriangleDirection;\n  handler: {\n    onPress(e: SyntheticEvent): void;\n    onRelease(e: SyntheticEvent): void;\n  };\n}) => (\n  <div\n    style={{\n      padding: \"0.5em\",\n      flexBasis: \"33%\",\n      alignSelf: \"stretch\",\n      WebkitUserSelect: \"none\",\n      touchAction: \"none\",\n      display: \"flex\",\n    }}\n    onTouchStart={handler.onPress}\n    onTouchEnd={handler.onRelease}\n  >\n    <Triangle\n      direction={direction}\n      stroke={color}\n      fill={pressed ? color : undefined}\n    />\n  </div>\n);\n","import { useMemoMerge } from \"../hooks/useMemoMerge\";\nimport React, { useMemo, CSSProperties, forwardRef } from \"react\";\nimport { DEFAULT_COLOR, DEFAULT_FONT_FAMILY } from \"../constants\";\n\nconst inputStyle = (color = DEFAULT_COLOR): CSSProperties => ({\n  width: \"100%\",\n  background: \"none\",\n  fontSize: \"2.8em\",\n  fontWeight: 900,\n  display: \"block\",\n  border: \"none\",\n  borderBottom: `5px solid ${color}`,\n  fontFamily: DEFAULT_FONT_FAMILY,\n  borderRadius: 0,\n  textAlign: \"center\",\n  padding: \"0.5em 0\",\n  textTransform: \"uppercase\",\n  caretColor: color,\n});\n\nfunction Input(\n  props: React.ComponentProps<\"input\">,\n  ref: React.Ref<HTMLInputElement>\n) {\n  return (\n    <input\n      autoCapitalize=\"characters\"\n      type=\"text\"\n      ref={ref}\n      {...props}\n      style={useMemoMerge([\n        useMemo(() => inputStyle(props.style?.color), [props.style?.color]),\n        props.style\n      ])}\n    />\n  );\n}\n\nexport default forwardRef(Input);\n","import React, {\n  ComponentProps,\n  Ref,\n  CSSProperties,\n  useMemo,\n  forwardRef\n} from \"react\";\nimport { useMemoMerge } from \"../hooks/useMemoMerge\";\nimport { DEFAULT_COLOR, DEFAULT_FONT_FAMILY } from \"../constants\";\n\nconst buttonStyle = (color: string, disabled?: boolean): CSSProperties => ({\n  border: `5px solid ${color}`,\n  color,\n  borderRadius: \"1.5em\",\n  padding: \"0.5em 1.5em\",\n  fontWeight: 900,\n  fontSize: \"1.5em\",\n  fontFamily: DEFAULT_FONT_FAMILY,\n  opacity: disabled ? 0.3 : 1,\n  background: \"none\",\n  transition: \"color 175ms ease-out, border-color 175ms ease-out\"\n});\n\nfunction Button(\n  { color = DEFAULT_COLOR, ...props }: ComponentProps<\"button\">,\n  ref: Ref<HTMLButtonElement>\n) {\n  return (\n    <button\n      ref={ref}\n      {...props}\n      style={useMemoMerge([\n        useMemo(() => buttonStyle(color, props.disabled), [\n          color,\n          props.disabled\n        ]),\n        props.style\n      ])}\n    >\n      {props.children}\n    </button>\n  );\n}\n\nexport default forwardRef(Button);\n","import { useEffect, useState, useMemo } from \"react\";\nimport {\n  MessageChannelToLobby,\n  createMessageChannelToLobby,\n} from \"../messaging/dataChannelMessaging\";\nimport { DEFAULT_RTC_PEER_CONFIG, SIGNALING_URL } from \"../constants\";\nimport useJsonWebsocket from \"./useJsonWebsocket\";\nimport { uuidV4 } from \"../utility\";\n\ntype Props = {\n  lobbyName: string;\n};\n\nexport default function useConnectionForPlayer({ lobbyName }: Props) {\n  const [lobbyMessageChannel, setLobbyMessageChannel] =\n    useState<MessageChannelToLobby>();\n  //Create id on client session to support reconnecting. This will be a secret between server/client.\n  const playerId = useMemo(() => {\n    const key = `playerId/${lobbyName}`;\n    let sessionId = sessionStorage[key];\n    if (sessionId == null) {\n      sessionId = uuidV4()\n      sessionStorage[key] = sessionId;\n    }\n    return sessionId;\n  }, [lobbyName]);\n\n  //only keep ws connection before webrtc is established\n  const socket = useJsonWebsocket(\n    lobbyMessageChannel == null ? `${SIGNALING_URL}/${playerId}` : undefined\n  );\n\n  useEffect(() => {\n    if (lobbyMessageChannel != null || socket.status != \"connected\") {\n      return;\n    }\n    const peerConnection = new RTCPeerConnection(DEFAULT_RTC_PEER_CONFIG);\n\n    const channel = peerConnection.createDataChannel(\"Client data channel\", {\n      maxRetransmits: 1,\n      ordered: false,\n    });\n    channel.onopen = () => {\n      const handles = createMessageChannelToLobby(peerConnection, channel);\n      setLobbyMessageChannel(handles);\n    };\n\n    peerConnection.onicecandidate = (event) => {\n      if (event.candidate != null) {\n        socket.send({\n          to: lobbyName,\n          from: playerId,\n          data: event.candidate.toJSON(),\n        });\n      }\n    };\n    let peerDisconnectTimeout: number | undefined;\n    peerConnection.oniceconnectionstatechange = () => {\n      //clear disconnect timeout if set.\n      clearTimeout(peerDisconnectTimeout);\n      const disconnect = () =>\n        setLobbyMessageChannel((channel) => {\n          channel?.destroy();\n          return undefined;\n        });\n      switch (peerConnection.iceConnectionState) {\n        case \"disconnected\":\n        case \"failed\": {\n          disconnect();\n          break;\n        }\n      }\n    };\n    socket.addListener(async ({ data }) => {\n      if (data.type === \"answer\") {\n        await peerConnection.setRemoteDescription(data);\n      } else if (\"candidate\" in data) {\n        await peerConnection.addIceCandidate(data);\n      }\n    });\n    peerConnection.createOffer().then(async (offer) => {\n      await peerConnection.setLocalDescription(offer);\n      socket.send({ data: offer, to: lobbyName, from: playerId });\n    });\n  }, [lobbyMessageChannel, lobbyName, socket]);\n\n  return lobbyMessageChannel;\n}\n","import { MessageChannelToLobby } from \"../messaging/dataChannelMessaging\";\nimport { Dispatch, SetStateAction, useState, useEffect, useMemo } from \"react\";\nimport usePingLatency from \"./usePingLatency\";\n\ntype SendType = Parameters<MessageChannelToLobby[\"send\"]>[0];\n\nconst createPlayerFunctions = (\n  setPlayerState: Dispatch<SetStateAction<PlayerState | undefined>>,\n  connection?: MessageChannelToLobby\n) => () => {\n  const sender = <TKey extends SendType>(\n    type: TKey,\n    stateKey?: keyof PlayerState\n  ) => (data: any) => {\n    //Optimistic updates if statekey provided\n    stateKey &&\n      setPlayerState(state => state && { ...state, [stateKey]: data });\n    connection?.send(\n      type,\n      data\n    );\n  };\n  return {\n    setName: sender(\"setName\", \"name\"),\n    setColor: sender(\"setColor\"),\n    setReady: sender(\"setReady\"),\n    setTurn: sender(\"turn\")\n  };\n};\n\nexport default function useStateForPlayer(connection?: MessageChannelToLobby) {\n  const latency = usePingLatency(connection);\n  const [playerState, setPlayerState] = useState<PlayerState>();\n  const [gameState, setGameState] = useState<GameState>();\n  useEffect(() => {\n    if (connection == null) {\n      return;\n    }\n\n    connection.on(\"playerState\", update =>\n      setPlayerState(\n        state =>\n          //assign undefined to the stateupdate and die.\n          ({ ...state, ...update } as PlayerState)\n      )\n    );\n    connection.on(\"gameState\", update =>\n      setGameState(\n        state =>\n          //same here.\n          ({ ...state, ...update } as GameState)\n      )\n    );\n  }, [connection]);\n\n  const playerFunctions = useMemo(\n    createPlayerFunctions(setPlayerState, connection),\n    [connection]\n  );\n  return [\n    playerState && { ...playerState, ...playerFunctions, latency },\n    gameState\n  ] as const;\n}\n","import { useState, useEffect } from \"react\";\nimport { MessageChannel, Converter } from \"../messaging/setupMessageChannel\";\n\n//This is messed up, but by keeping sending ping packages over the channel, latency is keeped consistent and low.\n//If nothing is sent for a couple of deciseconds, latency will start to vary wildly.\n//This might have to do with my router (known to be shitty in the past)\nexport default function usePingLatency(\n  connection?: MessageChannel<\n    { ping: Converter<number> },\n    { ping: Converter<number> }\n  >,\n  tickRateMs = 100,\n  tickReportCount = 40\n) {\n  const [latency, setLatency] = useState<number>();\n  useEffect(() => {\n    if (connection == null) {\n      return;\n    }\n    let sentPings = 0;\n    let receivedPings = 0;\n    const pings = new Uint8Array(tickReportCount);\n    const pingInterval = window.setInterval(() => {\n      if (sentPings > receivedPings) {\n        //A ping is already out, skip sending new ones until it's back.\n        return;\n      }\n      connection.send(\"ping\", performance.now());\n      sentPings++;\n    }, tickRateMs);\n    connection.on(\"ping\", (timeStamp) => {\n      pings[receivedPings] = performance.now() - timeStamp;\n      receivedPings++;\n      if (receivedPings >= tickReportCount) {\n        setLatency(\n          Math.round(pings.reduce((acc, ping) => acc + ping, 0) / receivedPings)\n        );\n        pings.fill(0);\n        receivedPings = 0;\n        sentPings = 0;\n      }\n    });\n    return () => {\n      window.clearInterval(pingInterval);\n      setLatency(undefined);\n    };\n  }, [connection, tickRateMs, tickReportCount]);\n  return latency;\n}\n","import React, { useState, useCallback, useRef } from \"react\";\nimport PlayerControls from \"./PlayerControls\";\nimport PlayerLayout from \"./Layout\";\nimport Input from \"./Input\";\nimport Button from \"./Button\";\nimport Banger from \"./Banger\";\nimport useConnectionForPlayer from \"../hooks/useConnectionForPlayer\";\nimport useStateForPlayer from \"../hooks/useStateForPlayer\";\n\ntype Props = {\n  lobbyName: string;\n};\n\ntype ClientPlayer = ReturnType<typeof useStateForPlayer>[0];\n\nexport default function Client({ lobbyName = \"new\" }: Props) {\n  const channel = useConnectionForPlayer({ lobbyName });\n  const [player, gameState] = useStateForPlayer(channel);\n  const renderCore = useCallback(() => {\n    if (player == null) {\n      return <Banger>Connecting</Banger>;\n    }\n    switch (player.state) {\n      case \"joining\":\n        return player.ready ? (\n          <Banger>Waiting</Banger>\n        ) : (\n          <EnterCreds {...player} colors={gameState?.colorAvailability} />\n        );\n      case \"playing\":\n        return (\n          <PlayerControls\n            setTurn={player.setTurn}\n            color={player.color}\n            latency={player.latency}\n          />\n        );\n      case \"dead\":\n        return <Banger>You dead</Banger>;\n    }\n  }, [player, gameState]);\n  return (\n    <PlayerLayout>\n      <Latency latency={player?.latency} />\n      {renderCore()}\n    </PlayerLayout>\n  );\n}\n\nfunction EnterCreds({\n  colors = {},\n  ...props\n}: ClientPlayer & { colors?: GameState[\"colorAvailability\"] }) {\n  const [hasInput, setHasInput] = useState(false);\n  const hasDefaultName = !hasInput && props.name.startsWith(\"Player \");\n  const onChangeInput = useCallback(\n    (ev: React.ChangeEvent<HTMLInputElement>) => {\n      setHasInput(true);\n      props.setName(ev.target.value);\n    },\n    [props.setName]\n  );\n  const inputRef = useRef<HTMLInputElement>(null);\n  return (\n    <article style={{ textAlign: \"center\", maxWidth: \"95%\", margin: \"auto 0\" }}>\n      <Input\n        ref={inputRef}\n        style={{ color: props.color, margin: \"1em auto\", maxWidth: \"75%\" }}\n        value={hasDefaultName ? \"\" : props.name}\n        onChange={onChangeInput}\n        placeholder={hasDefaultName ? props.name : \"\"}\n        maxLength={10}\n        autoCorrect=\"off\"\n        spellCheck={false}\n      />\n      <section\n        style={{\n          display: \"flex\",\n          flexDirection: \"row\",\n          width: \"100%\",\n          flexWrap: \"wrap\",\n          justifyContent: \"center\"\n        }}\n      >\n        {Object.entries(colors).map(([color, available]) => {\n          const isPlayerColor = color === props.color;\n          return (\n            <figure\n              key={color}\n              onClick={() => available && props.setColor(color)}\n              style={{\n                boxSizing: \"border-box\",\n                width: 50,\n                height: 50,\n                margin: 15,\n                borderRadius: \"50%\",\n                background: color,\n                transform:\n                  isPlayerColor || !available\n                    ? `scale(${isPlayerColor ? 1.2 : 0.8})`\n                    : undefined,\n                transition:\n                  \"transform 150ms ease-out, box-shadow 150ms ease-out, opacity 75ms ease-out\",\n                opacity: isPlayerColor || available ? 1 : 0.2,\n                boxShadow: isPlayerColor\n                  ? \"inset 0 0 0 5px rgba(0,0,0,0.1)\"\n                  : \"none\"\n              }}\n            >\n              <figcaption style={{ visibility: \"hidden\" }}>{color}</figcaption>\n            </figure>\n          );\n        })}\n      </section>\n      <section style={{ marginTop: \"1.5em\" }}>\n        <Button\n          color={props.color}\n          disabled={!props.name}\n          onClick={() => props.setReady(true)}\n        >\n          Ready!\n        </Button>\n      </section>\n    </article>\n  );\n}\n\nconst Latency = ({ latency }: { latency?: number }) =>\n  latency ? (\n    <span\n      style={{\n        position: \"absolute\",\n        top: 0,\n        right: 0,\n        WebkitUserSelect: \"none\"\n      }}\n    >\n      {latency} ms\n    </span>\n  ) : null;\n"],"names":["_a","direction","fill","stroke","DEFAULT_COLOR","strokeWidth","_b","props","points","useMemo","min","max","noValue","Error","join","__spreadValues","viewBox","style","width","maxHeight","display","strokeLinejoin","transition","setTurn","color","children","currentTurn","setCurrentTurn","useState","minusPressed","setMinusPressed","plusPressed","setPlusPressed","arrowDirections","useMediaMatch","(orientation: landscape)","(orientation: portrait)","useInputHandlers","value","setPress","handle","press","ev","preventDefault","newTurnValue","onPress","onRelease","turnMinus","turnPlus","PlayerLayout","centered","TurnButton","pressed","handler","padding","flexBasis","alignSelf","WebkitUserSelect","touchAction","onTouchStart","onTouchEnd","Triangle","forwardRef","ref","__spreadProps","autoCapitalize","type","useMemoMerge","background","fontSize","fontWeight","border","borderBottom","fontFamily","DEFAULT_FONT_FAMILY","borderRadius","textAlign","textTransform","caretColor","_c","_d","disabled","opacity","buttonStyle","lobbyName","lobbyMessageChannel","setLobbyMessageChannel","playerId","key","sessionId","sessionStorage","uuidV4","socket","useJsonWebsocket","SIGNALING_URL","status","peerConnection","RTCPeerConnection","DEFAULT_RTC_PEER_CONFIG","channel","createDataChannel","maxRetransmits","ordered","onopen","handles","createMessageChannelToLobby","onicecandidate","event","candidate","send","to","from","data","toJSON","oniceconnectionstatechange","peerDisconnectTimeout","iceConnectionState","channel2","destroy","addListener","async","setRemoteDescription","addIceCandidate","createOffer","then","offer","setLocalDescription","connection","latency","tickRateMs","tickReportCount","setLatency","sentPings","receivedPings","pings","Uint8Array","pingInterval","window","setInterval","performance","now","on","timeStamp","Math","round","reduce","acc","ping","clearInterval","usePingLatency","playerState","setPlayerState","gameState","setGameState","state","update","playerFunctions","sender","stateKey","setName","setColor","setReady","createPlayerFunctions","useConnectionForPlayer","player","useStateForPlayer","renderCore","useCallback","Banger","ready","EnterCreds","colors","colorAvailability","PlayerControls","Latency","_e","_f","hasInput","setHasInput","hasDefaultName","name","startsWith","onChangeInput","target","inputRef","useRef","maxWidth","margin","Input","onChange","placeholder","maxLength","autoCorrect","spellCheck","flexDirection","flexWrap","justifyContent","Object","entries","map","available","isPlayerColor","onClick","boxSizing","height","transform","boxShadow","visibility","marginTop","Button","position","top","right"],"mappings":"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"}