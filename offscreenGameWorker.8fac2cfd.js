parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"vBVb":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.voidConverter=exports.stringConverter=exports.booleanConverter=exports.numberConverter=exports.jsonConverter=void 0;const e={serialize:JSON.stringify,deserialize:JSON.parse};exports.jsonConverter=e;const r={serialize:String,deserialize:Number};exports.numberConverter=r;const o={serialize:String,deserialize:Boolean};exports.booleanConverter=o;const s=()=>({serialize:e=>e,deserialize:e=>e}),i={serialize:e=>e,deserialize:e=>e};exports.stringConverter=i;const t={serialize:e=>e,deserialize:e=>e};exports.voidConverter=t;
},{}],"Uwl8":[function(require,module,exports) {
"use strict";function e(e){return(t,n,...s)=>{const r=new Set(s),i=new Map;return e.triggerReceive(t=>{var s;if("string"!=typeof t)return;const o=t.indexOf(";"),l=o&&t.substring(0,o);if(!l)return;r.has(l)&&e.send(t);const d=i.get(l);if(null==d?void 0:d.length){const e=null===(s=n[l])||void 0===s?void 0:s.deserialize(t.substring(o+1));d.forEach(t=>t(e))}}),{send(n,s,...r){const i=`${n};${t[n].serialize(s)}`;e.send(i,...r)},on(e,t){var n;i.has(e)||i.set(e,[]),null===(n=i.get(e))||void 0===n||n.push(t)},off(e,t){var n,s;const r=null===(n=i.get(e))||void 0===n?void 0:n.indexOf(t);null!=r&&-1!=r&&(null===(s=i.get(e))||void 0===s||s.splice(r,1))},destroy:e.destroy}}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"PAKG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createChannelToWorker=a,exports.createChannelFromWorker=i;var e=require("./valueConverters"),r=n(require("./setupMessageChannel"));function n(e){return e&&e.__esModule?e:{default:e}}const t={turn:{serialize:e=>`${e.id};${e.turn}`,deserialize(e){const r=e.split(";");return{id:r[0],turn:parseFloat(r[1])}}},run:e.voidConverter,stop:e.voidConverter,destroy:e.voidConverter,inputSnakeData:e.jsonConverter},o={snakeCollision:e.stringConverter,canvasCreated:e.voidConverter};function s(e){const n=e.onmessage;return(0,r.default)({send:e.postMessage.bind(e),triggerReceive(r){e.onmessage=(e=>r(e.data))},destroy(){e.onmessage=n}})}function a(...e){return s(...e)(t,o)}function i(...e){return s(...e)(o,t)}
},{"./valueConverters":"vBVb","./setupMessageChannel":"Uwl8"}],"cWSR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;const o=1e3/60;function e(e,{snakeSpeed:t=3.3,lineWidth:n=8,turnRadius:i=.05,startPositionSpread:s=.5,startingHoleChancePercantage:a=-5,holeDuration:r=10,maxVerticalResolution:l=1080}={}){var c;{const u=null!==(c=e.getContext("2d",{desynchronized:!0,willReadFrequently:!0}))&&void 0!==c?c:(()=>{throw new Error("Could not get Snake canvas 2d context")})();if(e.height>l){const o=e.height/l;u.scale(o,o)}const p=()=>({hasCollided:!1,turn:0,direction:Math.round(360*Math.random()),holeChance:a,position:{x:(Math.random()+s)*(u.canvas.width*s),y:(Math.random()+s)*(u.canvas.height*s)},currentHoleSection:0,erasePos:null}),C=[];function h(o,t,i,s=!0){if(o.hasCollided)return;if(0==o.currentHoleSection&&(o.holeChance>0&&100*Math.random()<o.holeChance?(o.currentHoleSection=r,o.holeChance=a):o.holeChance=o.holeChance+.1),s&&(o.position.x<0||o.position.x>e.width||o.position.y<0||o.position.y>e.height)&&(o.hasCollided=!0,o.onCollision()),null!=o.erasePos){u.beginPath(),u.lineCap="square",u.lineWidth=n+3;const e=u.globalCompositeOperation;u.globalCompositeOperation="destination-out",u.moveTo(o.erasePos.x,o.erasePos.y),u.lineTo(o.position.x,o.position.y),u.stroke(),u.closePath(),o.erasePos=null,u.globalCompositeOperation=e}o.currentHoleSection>0&&(o.erasePos=Object.assign({},o.position),o.currentHoleSection--),u.beginPath(),u.lineCap="square",u.lineWidth=n,u.strokeStyle=o.color,u.moveTo(o.position.x,o.position.y),o.direction+=o.turn*i,o.position.x+=t*Math.cos(o.direction),o.position.y+=t*Math.sin(o.direction),u.lineTo(o.position.x,o.position.y),u.stroke(),u.closePath()}let g=!0;function d(){g=!0}return{run:function(){let e=!0,n=performance.now();g&&(g=!1,requestAnimationFrame(function s(a){let r=(a-n)/o;const l=t*(r=r<4?r:4),c=i*r;n=a;for(const o of C)h(o,l,c,e);e=!e,!g&&requestAnimationFrame(s)}))},stop:d,inputSnakeData:o=>{var e,t;let n=null!==(e=C.findIndex(e=>e.id===o.id))&&void 0!==e?e:C.length;const i=Object.assign(Object.assign({},null!==(t=C[n])&&void 0!==t?t:p()),o);return C[n>=0?n:0]=i,o=>{i.turn=o}},destroy(){d()}}}}
},{}],"RPTN":[function(require,module,exports) {
"use strict";var e=require("../messaging/canvasWorkerMessaging"),n=a(require("./snakeGameContext"));function a(e){return e&&e.__esModule?e:{default:e}}const s=a=>t=>{if(t.data instanceof OffscreenCanvas){const o=(0,e.createChannelFromWorker)(a),r=(0,n.default)(t.data),i=new Map;o.on("turn",e=>{var n;return null===(n=i.get(e.id))||void 0===n?void 0:n(e.turn)}),o.on("inputSnakeData",e=>i.set(e.id,r.inputSnakeData(Object.assign(Object.assign({},e),{onCollision:()=>o.send("snakeCollision",e.id)})))),o.on("run",r.run),o.on("stop",r.stop),o.on("destroy",()=>{r.destroy(),onmessage=s(a)}),o.send("canvasCreated",void 0)}};onmessage=s(self);
},{"../messaging/canvasWorkerMessaging":"PAKG","./snakeGameContext":"cWSR"}]},{},["RPTN"], null)
//# sourceMappingURL=/acthung-webrtc/offscreenGameWorker.8fac2cfd.js.map